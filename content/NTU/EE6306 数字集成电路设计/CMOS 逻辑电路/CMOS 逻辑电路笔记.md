---
date: 2024-09-02 18:00
aliases: 
tags: 
publish: "true"
number headings: auto, first-level 1, max 5, contents ^toc, 1.1.
---
>[! info]
>《数字集成电路》第 6 章 CMOS 组合逻辑门
>《数字集成电路》第 7 章时序逻辑电路
>

# 1. 静态 CMOS 逻辑电路

每个时间点，门的输出都是连接在 $V_{DD}$ 或者 $V_{SS}$。电路的输出结果只和逻辑电路本身结构有关（不考虑开关期间的瞬态效应），也就是组合逻辑电路。

# 2. 动态 CMOS 逻辑电路

动态 CMOS 逻辑电路在伪 NMOS 逻辑电路的基础上，在地增加了一个 NMOS。

动态 CMOS 逻辑能够在避免静态功耗的同时，减少逻辑门的数量。通过增加时钟输入，能完成预充电和条件求值两个阶段。

>[! note]
>还有类似的只用 PUN 的电路，则是预放电，与使用 PDN 的电路相反。
>

## 2.1. 动态逻辑：基本原理

动态门具有和互补 CMOS 完全一样的 PDN。电路有两个工作阶段：**预充电和条件求值**，由时钟信号 CLK 决定。

![[动态门基本原理.png|300]]

### 2.1.1. 预充电

当 $CLK = 0$ 时，输出节点 Out 被 $M_{p}$ 预充电到 $V_{DD}$（由输出电容 $C_{L}$ 存储电荷），此时 $M_{e}$ 关闭，PDN 不工作。

$C_{L}$ 是结电容、布线电容以及扇出门输入电容的组合。

>[! note]
>求值 FET 消除了预充电期间的任何静态功耗，因为没有输入，求值 FET 始终关闭。
>

### 2.1.2. 求值

当 CLK=1 时预充电管 $M_{p}$ 关断, 求值管 $M_{e}$ 导通。输出根据输入值和下拉拓扑结构的情况有条件地放电。

如果输入使得 PDN 导通，那么输出和 GND 之间有低阻通路使得 $C_{L}$ 的电荷流失；如果 PDN 关断，预充电维持。

在求值器件，输出电容充电路径关断，其最多只能放电一次。 ^3e916e

>[! attention]
>注意, 在求值期间如果 PDN 关断, 则输出有可能处于高阻抗状态。这一特点与相应的静态门的情况截然不同, 静态门在输出和其中一条电源线之间总会存在一条低阻抗通路。
>

### 2.1.3. 动态逻辑门重要特性

- 静态 CMOS 完全一样的 PDN
- 全摆幅输出（$V_{OL}=GND,\ V_{OH}=V_{DD}$）
- 晶体管的数目 (对于复杂门) 明显少于静态情况: 为 $N+2$。  
- 是无比的逻辑门。PMOS 的尺寸仅仅影响自身的翻转时间和时钟功耗

>[! question] 
>为什么 PMOS 的尺寸会影响时钟功耗？
>

- 逻辑门只有动态功耗。
	- $V_{DD}$ 和 GND 之间没有直接通路
	- 比静态电路更高的输出转移概率（输入一定，输出不断跳动）
	- 动态功耗也可能高于静态 CMOS 电路。
- 动态逻辑门具有较快的开关速度
	- 第一个 (明显的) 原因是由于减少了每个门晶体管的数目, 并且每个扇入对前级只表现为一个负载晶体管, 因而降低了负载电容 $C_{load}$, 这相当于降低了逻辑努力。
	- 二个原因是动态门没有短路电流，并且由下拉器件提供的所有电流都用来对负载电容放电。
- 需要预充电/求值时钟

## 2.2. 动态逻辑的速度和功耗

根据前文的叙述可以知道，一旦完成预充电，输出信号总是为高电平，只要求值电路保持关闭，那么就不存在 $t_{pLH}$。只有当求值电路导通的时候，输出才会翻转。说明 $t_{pHL}$ 和 $C_{L}$ 以及 PDN 的吸电流的能力有关。

>[! attention]
>这里忽略了预充电时间对门的影响，这个由 $C_{L}$ 决定的。

## 2.3. 动态设计中的信号完整性问题

动态逻辑比静态逻辑有更高的性能。但是有以下几个重要问题需要考虑。

### 2.3.1. 电荷泄露

^48ef1c

动态门的输出是存储在输出电容上的。由于存在漏电电流，电容的电荷会逐渐减少，最终使得这个门出错。

![[动态电路的漏电问题.png|400]]

上图是基本动态反相器电路的漏电来源。源 1 和来源 2 分别为 NMOS 下拉器件 $M_{1}$ 的反偏二极管和[[亚阈值漏电]]。注意，由于它的反偏二极管 (漏电来源 3) 和亚阈值导电 (漏电来源 4)，PMOS 预充电器件也引起一些漏电流。

由此可知，使用动态电路有一个最低的时钟频率，否则漏电会导致严重的输出错误。

在求值期间关断 PDN 使输出节点处于高电阻也会引起漏电。

漏电问题可以通过降低求值期间输出节点上的输出阻抗来解决。通常是增加一个泄漏晶体管，例如用一个带反馈（消除静态功耗）的伪 NMOS 型上拉器件来给电容补充电荷。 ^621e00

![[静态泄露器补偿电荷泄漏.png|400]]

当 CLK=0，且 PDN 关闭的时候，电容使得输出为高电平，从而使得泄漏器（bleeder）导通，电容补充电荷。如果 PDN 导通，电容电荷流失，则又会使得泄漏器关闭。

>[! question]
>那这里是否说明 PDN 的吸电流能力必须要比泄漏器更强呢，否则会导致泄漏器无法正常工作。

### 2.3.2. 电荷分享

![[动态电路中的电荷分享.png|300]]

对于上图中的电路而言，电荷分享就是指在某种情况下，$C_{L}$ 的电荷被 $C_{a}$ 和 $C_{b}$ 分享，导致 $C_{L}$ 的电荷量减小，输出电压减小。因为前面提到的[[#^3e916e|动态电路性质]]使得电压无法回复。

解决电荷再分布最常用也是最有效的办法是对关键的内部节点预充电，如使用一个 P1MOS 管连接 $V_{DD}$ 和电容。但是会增加面积和电容。

### 2.3.3. 电容耦合

电容耦合对电路的影响形式主要有两个，一个是串扰，另一个是背栅。串扰会使得有较高输出阻抗的电路更容易被影响，产生的电容耦合会破坏浮空节点的状态。背栅（backgate）即输出至输入耦合。$In$ 翻转为高电平，使得 $M_{5}$ 关闭 $M_{3}$ 导通，$Out_{2}$ 变为低电平。$M_{4}$ 的两个寄生电容失去了高电平充电，并且有了放电路径。从而使得 $Out_{1}$ 有了漏电路径。

背栅耦合会使得动态门输出显著降低，可能导致电路求值错误；也使得静态门的输出不能全程下降到 0V，从而导致了少量的静态功耗损失。

![[背栅耦合的例子.png|400]]

### 2.3.4. 时钟馈通

时钟馈通又是电容耦合的一个特殊例子。时钟的快速上升和下降会耦合到信号节点上。当 PDN 不导通时, 这一电容耦合会在时钟由低至高翻转时引起动态节点的输出上升到 $V_{DD}$ 以上。其次, 快速上升和下降的时钟边沿会耦合到信号节点上，参考上图（b）。

时钟馈通的危险在于它可能使预充电管正常情况下的反偏结二极管变为正向偏置（源极衬底结）。这会使电子注入衬底中, 它们可能为附近处于“1”(高电平) 状态的高阻抗节点所收集: 最终导致出错  CMOS 闩锁则是这一注人的另一种可能结果。

## 2.4. 串联动态门

直接串联动态门形成多级逻辑结构的方法并不可行。这个问题的关键就在于，在时钟从 0 到 1 的时候，$out_{1}$ 的电容放电需要时间，这个放电的过程会导致其串联的动态门的 NMOS 导通，从而给第二个动态门的输出创造了放电路径，使得输出电压降低，噪声容限降低并且功能出错。

![[动态电路串联.png|400]]

在预充电期间置所有的输入为 0 可以解决这个问题。这样在预充电之后下拉网络中所有的晶体管都被关断, 因此在求值期间不会发生存储电容的错误放电。方法之一则是下面的多米诺逻辑。

### 2.4.1. 多米诺逻辑

#### 2.4.1.1. 基本结构

![[多米诺 CMOS 逻辑.png|400]]

一个多米诺逻辑模块是由个 n 型动态逻辑块后面接一个静态反相器所构成。静态的反相器使得原本预充电的高电平输出变成了低电平，而求值期间的高到低的翻转也成了低到高的翻转。

除此之外静态反相器还使得多米诺门的输出具有了低阻抗，由此提高了抗噪声能力。并且其还能隔离内部和负载电容。还能解决[[#^621e00|电荷泄露]]的问题。

#### 2.4.1.2. 多米诺门串联链的工作情况

在预充电期间, 所有的输入都置为 0。在求值期间第一个多米诺块的输出或者停留在 0 或者从 $0\to 1$ 翻转, 从而影响第二个门。也就是说，在多米诺链中，最终输出的变化必定始于第一级。

其有以下特点，
- 只能实现非反向逻辑。因为多米诺门的输出要么保持到 0，要么实现 $0 \to 1$，无法完成 NOT 门的效果。
- 可以达非常高的速度，只有上升延时，$t_{pHL}=0$。

#### 2.4.1.3. 解决多米诺逻辑非反向的问题

一般的方法是采用差分逻辑。双轨多米诺（Dual-rail domino）在原理上类似于前面讨论的 DCVSL 结构，但它采用一个预充电负载而不是一个静态交叉连接PMOS 负载。

![[简单的双轨多米诺逻辑门.png|400]]

差分电路能实现任意功能，代价就是功耗高，因为无论输入为何值，每个时钟周期总有一次翻转。

#### 2.4.1.4. 多米诺门的优化

通过采用一个较小 (最小尺寸) 的 NMOS 器件和一个较大的 PMOS 器件来使得静态反相器的 $\beta$ 比值比较大。

### 2.4.2. np-CMOS

np-CMOS 通过使用两种类型 (n 型树和 p 型树) 的动态逻辑, 因而避免了在关键路径中由多米诺逻辑引人的额外静态反相器。

![[np-CMOS 逻辑电路.png|300]]

在 np-CMOS 电路中，n 型树与 p 型树的对偶性使得n 型可以直接驱动 p 型，但是如果要连接另外一个 n 型树门时，需要一个反相器。

## 2.5. 静态电路和动态电路的对比

- 静态
	- 在存在噪声的情况下具有健壮性的优点
	- 设计过程无故障，易于自动化 
	- 对于具有大扇入的复杂门，需要在面积和性能之间进行权衡 
	- 伪 nMOS 简单、快速，但代价是降低了噪声容限和静态功耗 
	- PTL 对于特定电路、多路复用器、加法器等， XOR 主导逻辑很有吸引力  
- 动态
	- 可能实现快速且小型的复杂门
	- 权衡在于寄生效应，例如电荷共享（设计过程变得更加困难） 
	- 电荷泄漏（需要定期刷新，这对电路的工作频率设置了下限）
# 3. 时序 CMOS 电路

## 3.1. 时序电路基础

时序电路的输出不仅取决与当前的输入，也取决于原先的输入，具有记忆功能。

首先简单描述一下，对于一个[[同步时序系统]]，通用有限状态机是由什么构成以及如何工作的。

![[有限状态机#通用有限状态机的构成]]

### 3.1.1. 时序电路的时间参数

![[同步寄存器的建立时间维持时间和传播延时的定义.png|400]]

同步寄存器有三个重要的时序参数：建立时间 $t_{su}$、维持时间 $t_{hold}$、传播延时 $t_{c-q}$ 。建立时间是在时钟翻转（对于正沿触发是 $0\to 1$）之前输出数据人（D）必须有效的时间。维持时间是在时钟边沿之后数据输入必须仍然有效的时间。假设建立和维持时间都满足要求，那么输入端 D 处的数据则在最坏情况下的传播延迟 (相对于时钟边沿) 之后被复制到输出端 Q。

由此我们可以推导出系统级的时序约束条件，即对于一个通用 FSM 而言，其工作的时钟周期 $T$ 必须能容纳电路中任何一级的最长延时。因为同步时序电路中，所有对时钟激励做出响应的开关事件是同时发生的。

有最小时钟周期 $T$ 为，
![[时序电路正确工作所要求的最小时钟周期]]

时序电路正确工作的另一个约束是对寄存器维持时间的要求, 即
![[时序电路正确工作所要求的寄存器维持时间]]

这一约束保证了时序元件的输人数据在时钟边沿之后能够维持足够长的时间, 而不会因新进入的数据流而过早改变

寄存器相关的时序参数值越小，整个系统的工作频率就能越高。

### 3.1.2. 存储单元的分类

#### 3.1.2.1. 前台存储器和后台存储器

#### 3.1.2.2. 静态存储器和动态存储器

#### 3.1.2.3. 锁存器和寄存器

## 3.2. 静态锁存器和寄存器

### 3.2.1. 双稳态原理

### 3.2.2. 多路开关型锁存器

### 3.2.3. 主从边沿触发寄存器

### 3.2.4. 低电压静态锁存器

### 3.2.5. 静态 SR 触发电路——用强信号直接写数据

## 3.3. 动态锁存器和寄存器

### 3.3.1. 动态传输门边沿触发寄存器

### 3.3.2. $\text{C}^{2}$ MOS——一种对时钟偏差不敏感的方法

### 3.3.3. 真单相钟控寄存器（TSPCR）

## 3.4. 其他寄存器类型



## 3.5. 流水线：优化时序电路的一种方法

### 3.5.1. 锁存型流水线和寄存型流水线

### 3.5.2. NORA-CMOS ——流水线结构的一种逻辑形式

## 3.6. 非双稳时序电路

### 3.6.1. 施密特触发器

### 3.6.2. 单稳时序电路

### 3.6.3. 不稳电路

## 3.7. 综述：时钟策略的选择

在芯片设计的早期就需要选择合适的时钟技术，以使得复杂电路中的所有操作能够同步发生。

最稳定且概念最简单的是两相主从设计。最主要的方法是采用多路开关型寄存器, 并通过简单地使时钟反相在本地产生两个时钟相位。


